# Blog_Web_Development

## ì§„í–‰ìƒí™©


### ğŸ” ë¯¸ë¦¬ ë³´ê¸°
- [íšŒì›ê°€ì…](#íšŒì›ê°€ì…)
- [OAuthë¡œ ë¡œê·¸ì¸](#OAuthë¡œ_ë¡œê·¸ì¸)
- [êµ¬ê¸€ ë¡œê·¸ì¸í•˜ê¸°](#êµ¬ê¸€_ë¡œê·¸ì¸í•˜ê¸°)
- [ì¹´ì¹´ì˜¤í†¡ ë¡œê·¸ì¸í•˜ê¸°](#ì¹´ì¹´ì˜¤í†¡_ë¡œê·¸ì¸í•˜ê¸°)
- [í˜ì´ì§•](#í˜ì´ì§•)
- [ë¬¸ì œìƒí™©](#ë¬¸ì œìƒí™©)
- [í•´ê²°ìƒí™©](#í•´ê²°ìƒí™©)


### íšŒì›ê°€ì…

![image](https://github.com/user-attachments/assets/1ff10135-f2af-4b2b-8818-a75f9d3f00ad)
- http://localhost:8080/signup íšŒì›ê°€ì… í•„ìš”
- blogdbì˜ usersí…Œì´ë¸”ì— OAuth ì´ë©”ì¼ê³¼ ë¹„ë°€ë²ˆí˜¸ê°€ ìˆì–´ì•¼ ë‹¤ìŒì´ ì§„í–‰ë¨-> ë””ë¹„ì— ë ˆì½”ë“œê°€ ì—†ì–´ë„ ëŒì•„ê°€ëŠ” ë°©ë²•ì´ ì—†ë‚˜?

### OAuthë¡œ ë¡œê·¸ì¸

![image](https://github.com/user-attachments/assets/7fc39bfb-c75a-4f7c-a49b-c28c54cdd980)
- http://localhost:8080/login

### êµ¬ê¸€ ë¡œê·¸ì¸í•˜ê¸°

![image](https://github.com/user-attachments/assets/f45e0aa3-1d51-43c2-a7fc-c76fc928e749)
- usersí…Œì´ë¸”ì— ìˆëŠ” êµ¬ê¸€ ì´ë©”ì¼ë¡œ ë¡œê·¸ì¸

****
![image](https://github.com/user-attachments/assets/e4a93f67-35ab-40d6-9049-b1e3d4d5dfb7)

- ë¹„ë°€ë²ˆí˜¸ ì…ë ¥
- ì´ë•Œ dbì—ì„œ ë¹„ë°€ë²ˆí˜¸ëŠ” ì•”í˜¸í™”ë˜ì–´ ìˆìŒ

****
![image](https://github.com/user-attachments/assets/5fe73090-f741-4033-9b17-2e1fc2e92b15)
- ê³„ì†

****
![image](https://github.com/user-attachments/assets/a9bd5ca9-48f8-43ab-82be-c05b9d1d9751)

- ê¸€ ëª©ë¡

****
![image](https://github.com/user-attachments/assets/5bbd54c8-b274-48d0-b6fa-6bb40df700e2)
- ê¸€ ë“±ë¡ ê°€ëŠ¥

****
![image](https://github.com/user-attachments/assets/15b2df53-181b-43ec-9a38-960f48df71c8)
- ìì‹ ì´ ì‘ì„±í•œ(ê°™ì€ ì´ë©”ì¼) ê¸€ì´ë©´ ìˆ˜ì •, ì‚­ì œ ê°€ëŠ¥

****
![image](https://github.com/user-attachments/assets/d65b9408-e81a-4c90-9598-7398fd346e16)
- ë‹¤ë¥¸ ì‚¬ìš©ìê°€ ì‘ì„±í•œ ê¸€ì€ ìˆ˜ì •, ì‚­ì œ ë¶ˆê°€ ->ë‹¤ë¥¸ ì‚¬ìš©ìì™€ ë³¸ì¸ì„ êµ¬ë¶„í•´ì„œ ë‹¤ë¥¸ ì‚¬ìš©ìì˜ ê¸€ì€ ìˆ˜ì •, ì‚­ì œ ë²„íŠ¼ì´ ì•ˆë³´ì´ê²Œ í•  ìˆœ ì—†ì„ê¹Œ

****
### ì¹´ì¹´ì˜¤í†¡ ë¡œê·¸ì¸í•˜ê¸°

![image](https://github.com/user-attachments/assets/9fe28100-ea9e-4fd4-9404-c4d7897698c6)
- usersí…Œì´ë¸”ì— ìˆëŠ” ì¹´ì¹´ì˜¤í†¡ ì´ë©”ì¼ë¡œ ë¡œê·¸ì¸
- ì´í›„ êµ¬ê¸€ ë¡œê·¸ì¸ê³¼ ë˜‘ê°™ì´ ë¨
****

### í˜ì´ì§•

![image](https://github.com/user-attachments/assets/4b24a95c-2639-424e-8606-e06a401b95bf)
- ìµœëŒ€ 10í˜ì´ì§€ê°€ ë³´ì´ê²Œ ë§Œë“¦ (ì˜ˆì‹œë¥¼ ìœ„í•´ ê²Œì‹œê¸€ì„ 1ê°œì”© ë³´ì´ê²Œ í–ˆìœ¼ë‚˜ ì‹¤ì œë¡œëŠ” ìµœëŒ€ 10ê°œê°€ ë³´ì„)
- 'ë‹¤ìŒ' ë²„íŠ¼ì€ ì•„ì§ í‘œì‹œë˜ì§€ ì•Šì€ ë‹¤ìŒ í˜ì´ì§€ ê·¸ë£¹ì´ ìˆì„ ë•Œë§Œ ë³´ì„(í™œì„±í™”)
- 'ì´ì „' ë²„íŠ¼ì€ ì´ì „ í˜ì´ì§€ ê·¸ë£¹ì´ 10 ì´ìƒì¼ ë•Œë§Œ ë³´ì„(í™œì„±í™”)

![image](https://github.com/user-attachments/assets/6d3a7409-318c-4729-bdda-cb5dcf454762)
- 'ë‹¤ìŒ' ë²„íŠ¼ì„ í´ë¦­ë©´ 11í˜ì´ì§€ë¡œ ì´ë™í•¨

![image](https://github.com/user-attachments/assets/9efb2499-5096-49c8-b834-713e478207e9)
- 11í˜ì´ì§€ì—ì„œ 'ë‹¤ìŒ' ë²„íŠ¼ì„í´ë¦­í•˜ë©´ 21í˜ì´ì§€ë¡œ ì´ë™í•¨
- í‘œì‹œë˜ì§€ ì•Šì€ ë‹¤ìŒ í˜ì´ì§€ ê·¸ë£¹ì´ ì—†ìœ¼ë¯€ë¡œ 'ë‹¤ìŒ' ë²„íŠ¼ì´ ë³´ì´ì§€ ì•ŠìŒ

![image](https://github.com/user-attachments/assets/48a40b93-10a2-4e4e-a19c-e269aa9172e4)
- 21í˜ì´ì§€ì—ì„œ 'ì´ì „' ë²„íŠ¼ í´ë¦­í•˜ë©´ 11í˜ì´ì§€ë¡œ 20í˜ì´ì§€ë¡œ ì´ë™
![image](https://github.com/user-attachments/assets/49802d70-c6ad-41f7-8747-7151d0d3fa27)
- 20í˜ì´ì§€ì—ì„œ 'ì´ì „' ë³´íŠ¼ í´ë¦­í•˜ë©´ 10í˜ì´ì§€ë¡œ ì´ë™
- í‘œì‹œë˜ì§€ ì•Šì€ ì´ì „ í˜ì´ì§€ ê·¸ë£¹ì´ ì—†ìœ¼ë¯€ë¡œ 'ì´ì „' ë²„íŠ¼ì´ ë³´ì´ì§€ ì•ŠìŒ


****
### ë¬¸ì œìƒí™©

1. nickname ì»¬ëŸ¼ëª…ì´ ê²¹ì¹˜ë©´ ì•ˆë¨
   - ë§Œì•½ì— ì‚¬ìš©ìê°€ êµ¬ê¸€, ì¹´ì¹´ì˜¤í†¡ ë¡œê·¸ì¸ì„ ì‹œë„í• ë•Œ ì´ë¦„(ex. í™ê¸¸ë™)ì´ ê°™ìœ¼ë¯€ë¡œ nicknameì— ë³¸ì¸ ì´ë¦„ì´ ë“¤ì–´ê°„ë‹¤.
 ```
  //OAuthê´€ë ¨í‚¤ ì €ì¥
    @Column(name="nickname",unique = true)
    private String nickname;

    //ìƒì„±ìì— nickname ì¶”ê°€
    @Builder
    public User(String email, String password,String nickname) {
        this.email = email;
        this.password = password;
        this.nickname = nickname;
    }

    //ì‚¬ìš©ì ì´ë¦„ ë³€ê²½
    public User update(String nickname) {
        this.nickname = nickname;
        return this;
    }
 ```
  - ìœ„ ì½”ë“œëŠ” User í´ë˜ìŠ¤ ì¼ë¶€ë¶„
```
 private User savedOrUpdate(OAuth2User oAuth2User) {
        Map<String, Object> attributes = oAuth2User.getAttributes(); //OAuth2 ì‚¬ìš©ì ì •ë³´(email, name ë“±)ë¥¼ ì†ì„± ë§µìœ¼ë¡œ ê°€ì ¸ì˜¨ë‹¤.

        // OAuth2Userì˜ ì†ì„± ì¶œë ¥
        String email;
        String name;

        if (attributes.containsKey("kakao_account")) {
            email = (String) ((Map<String, Object>) attributes.get("kakao_account")).get("email");
            System.out.println("Email from Kakao: " + email);
            name = (String) ((Map<String, Object>) attributes.get("properties")).get("nickname");

        } else {
            // êµ¬ê¸€ ì‚¬ìš©ì ì •ë³´ ì²˜ë¦¬
            email = (String) attributes.get("email");
            name = (String) attributes.get("name");
        }

        User user = userRepository.findByEmail(email)
                .map(entity -> {
                    // ë¡œê·¸ ì¶”ê°€
                    System.out.println("User found, updating: " + entity);
                    return entity.update(name);
                })
                ...
;
        return userRepository.save(user); //ìƒˆë¡œìš´ ì‚¬ìš©ì ì •ë³´ë¥¼ ì €ì¥í•˜ê±°ë‚˜ ì—…ë°ì´íŠ¸ëœ ì‚¬ìš©ì ì •ë³´ë¥¼ ì €ì¥í•œë‹¤.
    }
```
- ìœ„ ì½”ë“œëŠ” Oauth2UserCustomService í´ë˜ìŠ¤ ì¼ë¶€ë¶„


![image](https://github.com/user-attachments/assets/7a1f11e9-aaa9-4fd0-94e6-950f15b47f33)
- ê°™ì€ nicknameìœ¼ë¡œ ë¡œê·¸ì¸ì‹œ ì—ëŸ¬
  
- ê²°ë¡ : ê°™ì€ ì‚¬ìš©ìê°€ êµ¬ê¸€ê³„ì •ì—ì„œ ì¹´ì¹´ì˜¤í†¡ ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸í•˜ê¸° ìœ„í•´ êµ¬ê¸€ ê³„ì • ë¡œê·¸ì•„ì›ƒí• ë•Œ, nicknameì´ ë³¸ì¸ ì´ë¦„ì´ ì•„ë‹Œ nullë¡œ ì—…ë°ì´íŠ¸ë˜ê²Œ ë§Œë“¤ê³  ì‹¶ìŒ(ì‹¤íŒ¨)

****
2.  blogdbì˜ usersí…Œì´ë¸”ì— OAuth ì´ë©”ì¼ê³¼ ë¹„ë°€ë²ˆí˜¸ê°€ ìˆì–´ì•¼í•¨
   - ë””ë¹„ì— ì—†ëŠ” ê³„ì •ìœ¼ë¡œ êµ¬ê¸€ ë¡œê·¸ì¸ ì‹œ,ì´ë©”ì¼ì€ ì‚½ì…ë˜ë‚˜ ë¹„ë°€ë²ˆí˜¸ê°€ ë””ë¹„ì— ì‚½ì…ì´ ì•ˆë¨
   - ì´ê±° ì–´ì§œí”¼ êµ¬ê¸€ ë¡œê·¸ì¸ë§Œ ì„±ê³µí•´ì•¼ ê¸€ì„ ì‘ì„±,ìˆ˜ì •,ì‚­ì œí•  ìˆ˜ ìˆìœ¼ë‹ˆê¹Œ ì‹ ê²½ ì•ˆì¨ë„ ë ê¹Œ? (ëª°ë¼)

****     
3. ë¡œê·¸ì•„ì›ƒí•˜ë©´ ì„¸ì…˜ ë° ì¿ í‚¤ ì‚­ì œ, í† í° ë¬´íš¨í™”ë˜ì–´ì•¼ í•¨
   - ë¡œê·¸ì•„ì›ƒë˜ë„ ì§ì „ ë¡œê·¸ì¸ë°©ì‹ìœ¼ë¡œ ë“¤ì–´ê°€ë©´ í† í°ì´ ì‚´ì•„ìˆìŒ...
```
        http.logout(logout -> logout
                .logoutRequestMatcher(new AntPathRequestMatcher("/logout", "GET"))
                .addLogoutHandler(new CustomLogoutHandler(oAuth2AuthorizationRequestBasedOnCookieRepository()))
                .logoutSuccessUrl("/login"));
```
- ìœ„ ì½”ë“œëŠ” WebOAuthSecurityConfigí´ë˜ìŠ¤ ì¼ë¶€ë¶„

  
```
@Override
    public void logout(HttpServletRequest request, HttpServletResponse response, Authentication authentication) {
        HttpSession session = request.getSession(false);
        if (session != null) {
            session.invalidate(); // ì„¸ì…˜ ë¬´íš¨í™”
            System.out.println("Session invalidated.");
        }
        authorizationRequestRepository.removeAuthorizationRequestCookies(request, response);
        System.out.println("Authorization request cookies removed.");
        if (authentication != null) {
            SecurityContextHolder.clearContext();
            System.out.println("Security context cleared.");
        }
    }
```
- ìœ„ ì½”ë“œëŠ” CustomLogoutHandler í´ë˜ìŠ¤ ì¼ë¶€ë¶„


- ê²°ë¡ :
- í¬ë¡¬ ì„¤ì •-> ê°œì¸ ì •ë³´ ë³´í˜¸ ë° ë³´ì•ˆ -> ì¸í„°ë„· ì‚¬ìš© ê¸°ë¡ ì‚­ì œë¥¼ í•´ì•¼ì§€ë§Œ í† í°ì´ ì‚¬ë¼ì§
- ë¡œê·¸ì•„ì›ƒë§Œìœ¼ë¡œ  í† í° ë¬´íš¨í™”, ì¿ í‚¤ ë° ì„¸ì…˜ ì‚­ì œí•˜ê³  ì‹¶ë‹¤....

****
4. ì¼ë°˜ ë¡œê·¸ì¸ìœ¼ë¡œ ë¡œê·¸ì¸í•˜ë©´ ê¸€ ë“±ë¡,ìˆ˜ì •,ì‚­ì œê°€ ì•ˆë¨
- OAuthAndSessionSecurityConfig í´ë˜ìŠ¤ë¥¼ ì£¼ì„ í•´ì œí•˜ê³  WebOAuthSecurityConfig ì£¼ì„ì²˜ë¦¬ í›„
```
<div class = "mb-4">
                    <form action="/login" method="POST">
                        <input type="hidden" th:name="${_csrf?.parameterName}" th:value="${_csrf?.token}" />
                        <div class="mb-3">
                            <label class="form-label text-white">Email address</label>
                            <input type="email" class="form-control" name="username">
                        </div>
                        <div class="mb-3">
                            <label class="form-label text-white">Password</label>
                            <input type="password" class="form-control" name="password">
                        </div>
                        <button type="submit" class="btn btn-primary">Submit</button>
                    </form>

                    <button type="button" class="btn btn-secondary mt-3" onclick="location.href='/signup'">íšŒì›ê°€ì…</button>
                </div>
```
- oauth.htmlì— ìœ„ ì½”ë“œ ì£¼ì„ í•´ì œ
![image](https://github.com/user-attachments/assets/933bd86b-91f0-4772-a93f-6dd8e84564c4)

- ì¼ë°˜ ë¡œê·¸ì¸ì„ í•˜ë©´ ê¸€ ëª©ë¡ì´ ë³´ì´ë‚˜ ê¸€ ë“±ë¡, ìˆ˜ì •,ì‚­ì œë¥¼ í•  ìˆ˜ ì—†ìŒ

- ê²°ë¡ : ì¼ë°˜ ë¡œê·¸ì¸ë„ ì•¡ì„¸ìŠ¤ í† í°, ë¦¬í”„ë ˆì‹œ í† í°ì„ ë°œê¸‰í•˜ê²Œ ë§Œë“¤ê³  ì‹¶ìŒ(ì‹¤íŒ¨)

  ### í•´ê²°ìƒí™©
